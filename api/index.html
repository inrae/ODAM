
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ODAM, Open data and access to data mining, Deployment and User's Guide">
      
      
      
        <meta name="author" content="Daniel Jacob">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2">
    
    
      
        <title>Web API - ODAM</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
    <script src="../js/jquery-2.1.1.min.js"></script>

    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="../css/pdfextra.css">
    
      <link rel="stylesheet" href="../css/lightbox.css">
    
    
      
  



  
  



  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-168923330-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#odam-web-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ODAM" class="md-header__button md-logo" aria-label="ODAM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ODAM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Web API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ODAM" class="md-nav__button md-logo" aria-label="ODAM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ODAM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../presentation/" class="md-nav__link">
        Presentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dataset-example/" class="md-nav__link">
        A dataset example
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data-preparation/" class="md-nav__link">
        Data collection and preparation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../services/" class="md-nav__link">
        Using ODAM
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data-explorer/" class="md-nav__link">
        Data Explorer
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-nav__icon md-icon"></span>
          
            <a href="./" class="md-nav__link md-nav__link--active"
              style="margin: initial; padding: initial; pointer-events: initial">
          
            Web API
          </a>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Web API
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization-mechanism" class="md-nav__link">
    Authorization mechanism
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#very-detailed-example-of-api-querying" class="md-nav__link">
    Very detailed example of API querying
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        <span class="md-nav__icon md-icon"></span>
        
          <a href="../json-schema/" class="md-nav__link"
            style="margin: initial; padding: initial; pointer-events: initial">
        
          JSON Schema
        </a>
      </label>
      <nav class="md-nav" aria-label="JSON Schema" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          
            <a href="../json-schema/" class="md-nav__link"
              style="margin: initial; padding: initial; pointer-events: initial">
          
            JSON Schema
          </a>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../json-schema/session-examples/" class="md-nav__link">
        R and Python session examples
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../json-schema/dataverse/" class="md-nav__link">
        Datapackage from Dataverse
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../json-schema/google-search/" class="md-nav__link">
        Google search
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../json-schema/odam-data-resource/" class="md-nav__link">
        ODAM-data-ressource
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../json-schema/odam-data-package/" class="md-nav__link">
        ODAM-data-package
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../publish/" class="md-nav__link">
        Publish your data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../todo/" class="md-nav__link">
        ToDo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization-mechanism" class="md-nav__link">
    Authorization mechanism
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#very-detailed-example-of-api-querying" class="md-nav__link">
    Very detailed example of API querying
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="odam-web-api">ODAM: Web API<a class="headerlink" href="#odam-web-api" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="services">Services<a class="headerlink" href="#services" title="Permanent link">&para;</a></h2>
<p>The ODAM API services are based on <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank">REST</a> services using a Resource Naming convention i.e an understandable naming of resources leading to a <a href="https://en.wikipedia.org/wiki/Web_API" target="_blank">Web API</a> (resource identification/query) that is easily exploitable and easy to implement in a script language (<a href="https://www.r-project.org/about.html" target="_blank">R</a> or <a href="https://www.python.org/" target="_blank">Python</a>).</p>
<p>Moreover, The ODAM API services follow the <a href="https://swagger.io/specification/" target="_blank">OpenAPI specifications</a>.
<br><br></p>
<p><strong>API Documentation on SwaggerHub</strong> : <a href="https://app.swaggerhub.com/apis-docs/INRA-PMB/ODAM/1.2.0/" target="_blank">INRA-PMB/ODAM/1.2.0</a></p>
<p><center>
<a href="../images/web2.png" data-lightbox="web2"><img src="../images/web2.png" width="600px"></a>
</center><br></p>
<p><strong>Four main services</strong> (i.e query-paths) are provided, as described below: </p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>check</td>
<td>Check the structure and consistency of the metadata files with the data files</td>
</tr>
<tr>
<td>build</td>
<td>Build the sqlite3 database allowing an acceleration of the queries</td>
</tr>
<tr>
<td>query</td>
<td>Query data based on metadata</td>
</tr>
<tr>
<td>infos</td>
<td>Get the content of the infos.md file (markdown format)</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>query</strong></p>
<p>Using the two metadata files namely <strong>a_attributes.tsv</strong> and <strong>s_subsets.tsv</strong>, it is possible to build a tree structure from which the data files can be queried to extract a subset. The tree structure is built on the Entity-Attribute-Value scheme.</p>
</li>
</ul>
<p><center>
<a href="../images/web1.png" data-lightbox="web1"><img src="../images/web1.png" width="600px"></a>
</center><br><br></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>&lt;dataset name&gt;</strong></td>
<td>Short name (tag) of your dataset</td>
<td>frim1</td>
</tr>
<tr>
<td><strong>&lt;subset&gt;</strong></td>
<td>Short name of a data subset</td>
<td>samples</td>
</tr>
<tr>
<td><strong>&lt;entry&gt;</strong></td>
<td>Name of an attribute entry (defined by the user in the a_attribute file (column ‘entry’)</td>
<td>sampleid</td>
</tr>
<tr>
<td><strong>&lt;category&gt;</strong></td>
<td>Name of the attribute category; (assigned by the user in the a_attribute file (column ‘category’). Possible values are:  ‘identifier’, ‘factor’, ‘qualitative’, ‘quantitative’</td>
<td>quantitative</td>
</tr>
<tr>
<td><strong>(&lt;subset&gt;)</strong></td>
<td>Set of data subsets by merging all the subsets with lower rank than the specified subset and following the pathway defined by the "obtainedFrom" links.</td>
<td>(samples) &lt;=&gt; plants + samples</td>
</tr>
<tr>
<td><strong>&lt;value&gt;</strong></td>
<td>Exact value of the desired entry or category</td>
<td>1 (for subset) or <br> Factor (for category)</td>
</tr>
<tr>
<td><strong>&lt;data format&gt;</strong></td>
<td>Format of the retrieved data; possible values are: <a href="https://en.wikipedia.org/wiki/Comma-separated_values" target="_blank">CSV</a>, <a href="https://en.wikipedia.org/wiki/Tab-separated_values" target="_blank">TSV</a>, <a href="https://www.w3schools.com/js/js_json_intro.asp" target="_blank">JSON</a> or <a href="https://www.w3schools.com/xml/" target="_blank">XML</a></td>
<td>tsv</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>infos</strong></p>
<p>This service allows you to retrieve additional information. See <a href="../data-preparation#4-additional-information">Additional information</a> in <a href="../data-preparation">Data collection an preparation</a>.</p>
</li>
<li>
<p><strong>check</strong></p>
<p>This service allows to perform a set of tests to check if the dataset is well formatted and structured according to the expected specifications. See <a href="../data-preparation#5-final-checking">Final checking</a> in <a href="../data-preparation">Data collection an preparation</a>.</p>
</li>
<li>
<p><strong>build</strong></p>
<p>This service builds the corresponding <a href="https://www.sqlite.org/cli.html" target="_blank">sqlite3</a> database to speed up response times on large files. See below in the section  <a href="#very-detailed-example-of-api-querying">Very detailed example of API querying</a>.</p>
</li>
</ul>
<p><br><br></p>
<p><strong>Two additional services</strong> (i.e query-paths) are provided (see <a href="../data-preparation/#4-additional-information">Additional information</a> section in <em>Data collection and preparation</em>),  as described below:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>image</td>
<td>Retrieve an image: <em>/getdata/image/{dataset}/{imagefile.png}</em></td>
</tr>
<tr>
<td>pdf</td>
<td>Retrieve a PDF file: <em>/getdata/pdf/{dataset}/{pdffile.pdf}</em></td>
</tr>
</tbody>
</table>
<p><strong>Some services</strong> (i.e query-paths) are available as shortcuts </p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>json</td>
<td>Query data with data formatted in JSON as output (shortcut for <em>../query/{dataset}/...?format=json</em>)</td>
</tr>
<tr>
<td>tsv</td>
<td>Query data with data formatted in TSV as output (shortcut for <em>../query/{dataset}/...?format=tsv</em>)</td>
</tr>
<tr>
<td>xml</td>
<td>Query data with data formatted in XML as output (shortcut for <em>../query/{dataset}/...?format=xml</em>)</td>
</tr>
</tbody>
</table>
<p><strong>Parameters</strong> that can be specified in the <em>query-string</em> as described below.
    These parameters can be combined : e.g <em>?format=tsv&amp;limit=100&amp;debug=1</em></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>format</td>
<td>Format of the retrieved data; possible values are: 'xml', ‘json’, 'csv' or ‘tsv'</td>
<td>format=tsv</td>
</tr>
<tr>
<td>auth</td>
<td>Set the API Key if required (non-preferential method)</td>
<td>auth=secret.key</td>
</tr>
<tr>
<td>limit</td>
<td>Limitation of the number of records provided</td>
<td>limit=100</td>
</tr>
<tr>
<td>debug</td>
<td>Provide information about the request (1 for debug, 0 for query output)</td>
<td>debug=1</td>
</tr>
</tbody>
</table>
<h2 id="authorization-mechanism">Authorization mechanism<a class="headerlink" href="#authorization-mechanism" title="Permanent link">&para;</a></h2>
<p>Currently, the ODAM API implements a <a href="https://swagger.io/docs/specification/authentication/api-keys/" target="_blank">key-based authorization mechanism</a>, which is different from the authentication mechanism. (see this <a href="https://blog.restcase.com/4-most-used-rest-api-authentication-methods/" target="_blank">blog</a>).</p>
<p><center>
<a href="../images/web3.png" data-lightbox="web3"><img src="../images/web3.png" width="600px"></a>
</center><br></p>
<p>The API key approach seems to us to be an adequate solution insofar as only the "read" functionality is concerned. Thus, without the need to edit, modify or delete, security is less of a concern. Furthermore, we have associated to these API keys the possibility to limit their usage according to the internet address (IP) of the machines from which the users make their requests.</p>
<p>There is no centralized management of these keys. The management is done for each dataset independently. The principle is simple: if you want to put a key protection on a dataset, just create a file named <strong>authkeys.tsv</strong> (<a href="https://en.wikipedia.org/wiki/Tab-separated_values" target="_blank">TSV</a> format) and add it in the same directory as the dataset. Without this file, the dataset is completely open. </p>
<ul>
<li>The file <strong>authkeys.tsv</strong> (<a href="https://en.wikipedia.org/wiki/Tab-separated_values" target="_blank">TSV</a> format) has three columns as described below: </li>
</ul>
<table>
<thead>
<tr>
<th>column</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1<sup>st</sup></td>
<td>IP Address or sub-network : in case of sub-network, only the common part of all IP adresses in the sub-network have to be specified. To signify all IPs, the character '*' will be used</td>
</tr>
<tr>
<td>2<sup>nd</sup></td>
<td>Can be either the API key or one of the two following keywords: 'deny' or 'allow'. 'deny' to forbid access (with or without API key), and 'allow' to allow access without API key.</td>
</tr>
<tr>
<td>3<sup>rd</sup></td>
<td>Comment or description</td>
</tr>
</tbody>
</table>
<p>Knowing that as soon as a rule is satisfied, the other rules are not read, it is important to order the rules according to a decreasing priority, the first one being the most important and so on.</p>
<ul>
<li>Example of Authorization file (authkeys.tsv)</li>
</ul>
<table>
<thead>
<tr>
<th>IP</th>
<th>Authorization</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>77.111</td>
<td>deny</td>
<td>VPN Opera Browser</td>
</tr>
<tr>
<td>10.0.0</td>
<td>allow</td>
<td>local VMs</td>
</tr>
<tr>
<td>192.168.100.50</td>
<td>allow</td>
<td>a PC Desktop</td>
</tr>
<tr>
<td>192.168.100.51</td>
<td>allow</td>
<td>another one PC Desktop</td>
</tr>
<tr>
<td>*</td>
<td>secret.key</td>
<td>Others</td>
</tr>
</tbody>
</table>
<ul>
<li>Another example of authorization file for a private dataset could be this: </li>
</ul>
<table>
<thead>
<tr>
<th>IP</th>
<th>Authorization</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.100.50</td>
<td>allow</td>
<td>a PC Desktop</td>
</tr>
<tr>
<td>*</td>
<td>deny</td>
<td>Others</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>The API key, when required, can be specified:</p>
<ul>
<li>in the API URL by adding 'auth={API key}' as a query parameter (i.e query string) :</li>
</ul>
<div class="highlight"><pre><span></span><code>curl &quot;https:/myserver/{query-paths}/{dataset}/.../?format={format}&amp;auth={API key}&quot;
</code></pre></div>

<ul>
<li>in the HTTP header (recommended method):</li>
</ul>
<div class="highlight"><pre><span></span><code>curl &quot;https:/myserver/{query-paths}/{dataset}/.../?format={format}&quot; -H &quot;X-Api-Key: {API key}&quot;
</code></pre></div>

</li>
</ul>
<p><br></p>
<p><strong>Note 1</strong>: You have to take into account that there may be several network cards on your machine, especially virtual network cards in the case of using a virtualization software (e.g. VirtualBox). So it is the IP address of the virtual card involved that should be put in the authkeys.tsv file in order to set specific authorizations. For example, the virtual network card of the distributed virtual machine for VirtualBox (see <a href="../install/">Installation</a>) has the IP address set as 192.168.99.100. See <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/ipconfig" target="_blank">ipconfig</a> for Windows and <a href="https://www.tecmint.com/ifconfig-vs-ip-command-comparing-network-configuration/" target="_blank">ifconfig/ip</a> for linux.</p>
<p><strong>Note 2</strong>: If an application hosted on a remote server makes requests, then of course the IP address of that server (which is not the IP of the client) will be taken as the default for comparison with the authorization settings. However, it is possible to implement a mechanism to modify the API query header by specifying the client's originating IP (see <a href="https://en.wikipedia.org/wiki/X-Forwarded-For" target="_blank">X-Forwarded-For</a>). This is what has been done for example in the data explorer.</p>
<p>The approach used in the data explorer is as follows:</p>
<ol>
<li>using a javascript, we retrieve the client's IP address which is sent to the server side (see <a href="https://stackoverflow.com/questions/391979/how-to-get-clients-ip-address-using-javascript" target="_blank">examples</a>)</li>
<li>On the server side, we modify the API request header by adding the X-Forwarded-For parameter positioned with the client IP address (using the R package httr, see <a href="https://rdrr.io/cran/httr/man/add_headers.html" target="_blank">add_headers</a>)</li>
</ol>
<h2 id="very-detailed-example-of-api-querying">Very detailed example of API querying<a class="headerlink" href="#very-detailed-example-of-api-querying" title="Permanent link">&para;</a></h2>
<p>Since all the experimental data tables were generated as part of an experiment associated with a Design of Experiment (<a href="https://en.wikipedia.org/wiki/Design_of_experiments" target="_blank">DoE</a>), each file thus contains data acquired sequentially as the experiment progressed. There must therefore be a link between each file, i.e. information that connects them together. In most cases (if not all), this information corresponds to identifiers that make it possible to precisely reference within the experiment each of the elements belonging to the same observation entity forming a coherent observation unit. For example, each plant, each sample has its own identifier, and each of these entities corresponds to a separate data file.
<br><br>
The files generated during data collection have to be organized according to the <a href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model" target="_blank">entity-relationship model</a> similar to relational database management systems (<a href="https://en.wikipedia.org/wiki/Relational_database" target="_blank">RDBMS</a>), as shown below with the FRIM1 dataset.</p>
<p><center>
<a href="../images/figure40a.png" data-lightbox="fig40a"><img src="../images/figure40a.png" width="600px"></a>
<a href="../images/figure40.png" data-lightbox="fig40"><img src="../images/figure40.png" width="600px"></a>
<br><p class="plegend center">Extract of structural metadata (file s_subsets.tsv) for FRIM1 dataset</p>
</center><br></p>
<p>Each file (an <strong>entity</strong>, i.e an observational unit) corresponds to a type of collected data (samples, compounds, ...) for which is associated a set of <strong>attributes</strong>, i.e. a set of variables that may include observed or measured variables (<strong>quantitative</strong> or <strong>qualitative</strong>), controlled independent variables (<strong>factors</strong>) and obviously an <strong>identifier</strong>.
<br><br>
Since there is a relationship between each of the files, it is therefore possible to combine them by following the paths of their mutual links. Suppose we want to retrieve <em>activome data</em> (enzyme expressions) combined with <em>NMR observed metabolite data</em>, including experimental metadata (factors and phenotypic data).</p>
<p>The ODAM API offers the possibility of combining data by following relational paths, using the  '<strong>(</strong>{<em>subset</em>}<strong>)</strong>' operator in the API query. Simply specify the desired subsets separated by a comma, as shown below:</p>
<p><center>
<a href="../images/figure43.png" data-lightbox="fig43"><img src="../images/figure43.png" width="600px"></a>
<br><p class="plegend center">'(activome,qNMR_metabo)' operator in the API query</p>
</center><br></p>
<p>The '<strong>(</strong>{<em>subset</em>}<strong>)</strong>' operator allows you to get data subsets by merging all the subsets with lower rank than the specified subsets and following the pathway defined by the “obtainedFrom" links.</p>
<p>Let's further assume that we only want the data for the 'Control' treatment. The ODAM API also offers the possibility of setting a selector called an 'entry' provided that such an entry has been specified for the attribute to which one wants to apply a selection, as shown below:</p>
<p><center>
<a href="../images/figure42.png" data-lightbox="fig42"><img src="../images/figure42.png" width="600px"></a>
<br><p class="plegend center">Extract of structural metadata (file a_attributes.tsv) for FRIM1 dataset</p>
</center><br></p>
<p>In our case, the 'Treatment' factor has the entry (alias) 'treatment'. It is therefore possible to use it as a selector in the API query.
Thus, our complete API query would be this one:</p>
<p><center>
<a href="../images/figure44.png" data-lightbox="fig44"><img src="../images/figure44.png" width="600px"></a>
<br><p class="plegend center">Complete API query</p>
</center><br><br></p>
<p>To test this query by yourself, you can go to <a href="https://app.swaggerhub.com/apis-docs/INRA-PMB/ODAM/1.2.0/" target="_blank">ODAM's Swagger interface</a> and play with the followed specific query :</p>
<p><center>
<a href="../images/figure45.png" data-lightbox="fig45"><img src="../images/figure45.png" width="600px"></a>
<br><p class="plegend center">ODAM API in Swagger</p>
</center><br><br></p>
<p>Finally, how does it work internally? How are the different subsets of data combined in practice?
Since each data subset being a data file, and linked to one or more other data subsets by means of common identifiers, it is possible to apply a SQL query from the data files as shown below: </p>
<p><center>
<a href="../images/figure41.png" data-lightbox="fig41"><img src="../images/figure41.png" width="600px"></a>
<br><p class="plegend center">SQL query corresponding to the API query</p>
</center><br><br></p>
<p>The application of SQL queries is performed</p>
<ul>
<li>
<p>either with the <a href="http://harelba.github.io/q/" target="_blank">q - Text as Data</a> tool which allows to apply SQL queries directly on CSV and TSV files. It is the default tool.</p>
</li>
<li>
<p>or with the <a href="https://www.sqlite.org/cli.html" target="_blank">sqlite3</a> tool which, by building a database and indexing it, allows to accelerate considerably the response times on large files. To proceed with the creation and indexing of the database, a call to the API is necessary (/getdata/build/{dataset}). To see what types of operations are made, try i.e this <a href="https://pmb-bordeaux.fr/getdata/build/frim1/debug?format=json" target="_blank">API query</a></p>
</li>
</ul>
<p>In addition, if you want to display information about the API query, just add '/debug' at the end of the query, as shown below:
<br>
<a href="https://pmb-bordeaux.fr/getdata/query/frim1/(activome,qNMR_metabo)/treatment/Control/debug" target="_blank">https://pmb-bordeaux.fr/getdata/query/frim1/(activome,qNMR_metabo)/treatment/Control/debug</a></p>
<p><br><br><br><br></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../data-explorer/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Data Explorer" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Data Explorer
            </div>
          </div>
        </a>
      
      
        
        <a href="../json-schema/" class="md-footer__link md-footer__link--next" aria-label="Next: JSON Schema" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              JSON Schema
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            INRAE, 2020
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.806c4996.min.js"></script>
      
        <script src="../js/lightbox.min.js"></script>
      
        <script src="../js/mermaid.min.js"></script>
      
    
  </body>
</html>